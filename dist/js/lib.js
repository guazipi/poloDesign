var CSDWPOLO={};CSDWPOLO.app={},CSDWPOLO.registerEvents=function(){$("a.various").fancybox({autoDimensions:!1,autoScale:!1,scrolling:"no",width:1080,height:700,speedIn:600,speedOut:200,overflow:"hidden",hideOnOverlayClick:!0}),$(".each-part").mouseover(function(e){var t=this.getAttribute("tipName"),i=$(this).offset().left,o=$(this).offset().top;$(".tip em").text(t),$(".tip").css({left:i+"px",top:o+"px",opacity:1})}),$(".each-part").mouseout(function(){$(".tip").css({opacity:0})}),$(".rotate-left").bind("click",function(){$(".polo-real div").each(function(e){if("block"==this.style.display)return 0==e?($(".polo-real div").eq(e).css({display:"none"}),$(".polo-real div").eq(3).css({display:"block"})):($(".polo-real div").eq(e).css({display:"none"}),$(".polo-real div").eq(e-1).css({display:"block"})),!1})}),$(".rotate-right").bind("click",function(){$(".polo-real div").each(function(e){if("block"==this.style.display)return 3==e?($(".polo-real div").eq(e).css({display:"none"}),$(".polo-real div").eq(0).css({display:"block"})):($(".polo-real div").eq(e).css({display:"none"}),$(".polo-real div").eq(e+1).css({display:"block"})),!1})});var e=[".fabric-type div",".fabric-color div",".collar-type div",".stripe-type div",".topfly-type div",".cuff-type div",".lowerhem-type div",".fork-type div",".braid-type div",".pocket-type div",".penBag-type div",".turtle-type div"];$.each(e,function(e,t){$(t).each(function(){this.onclick=function(){if(!this.querySelector("div img")){$(t).each(function(){this.innerHTML=""});var e=document.createElement("img");e.src="./images/tick.png",this.appendChild(e)}}})})},CSDWPOLO.init=function(){$(".steps div").each(function(e){this.onclick=function(){var t=e;$(".panel-content > div").each(function(){this.style.display="none"}),$(".panel-content > div").eq(t).css({display:"block"});var i=$(".steps div").length;if(t==i-1?(CSDWPOLO.app.logoMesh.visible=!0,$(".model-container").fadeIn(),$(".polo-container").fadeOut()):$(".polo-container").is(":visible")||($(".model-container").fadeOut(),$(".polo-container").fadeIn()),$(".steps div").each(function(){this.style.borderRight="1px solid rgb(215, 215, 215)",this.style.borderTop="1px solid rgb(215, 215, 215)",this.style.borderLeft="1px solid rgb(215, 215, 215)",this.style.borderBottom="1px solid rgb(215, 215, 215)"}),$(".steps div").eq(t).css({borderRight:"1px solid rgb(255, 255, 255)",borderTop:"2px solid rgb(6, 243, 13)",borderLeft:"2px solid rgb(6, 243, 13)",borderBottom:"2px solid rgb(6, 243, 13)"}),0!=t){t-=1;do $(".steps div").eq(t).css({borderRight:"2px solid rgb(6, 243, 13)",borderTop:"1px solid rgb(6, 243, 13)",borderLeft:"2px solid rgb(6, 243, 13)",borderBottom:"1px solid rgb(6, 243, 13)"}),t-=1;while(t>=0)}}}),$("#preStep").bind("click",function(){var e,t=$(".panel-content > div").length;$(".panel-content > div").each(function(t){"block"==this.style.display&&(e=t,this.style.display="none")}),0==e?$(".panel-content > div").each(function(e){return this.style.display="block",!1}):e==t-1?($(".model-container").fadeOut(),$(".polo-container").fadeIn(),CSDWPOLO.changeStatsOnStepsPanelPre(e)):CSDWPOLO.changeStatsOnStepsPanelPre(e)}),$("#nextStep").bind("click",function(){var e,t=$(".panel-content > div").length;$(".panel-content > div").each(function(t){"block"==this.style.display&&(e=t,this.style.display="none")}),e==t-1?(alert("恭喜你,需要保存购物车了！"),$(".panel-content > div").eq(t-1).css({display:"block"}),$("#nextStep > span").each(function(){return this.innerHTML="",this.innerHTML="done@!",!1})):e==t-2?(CSDWPOLO.getAllCustomInfo(),CSDWPOLO.app.logoMesh.visible=!0,$(".polo-container").fadeOut(),$(".model-container").fadeIn(),CSDWPOLO.changeStatsOnStepsPanelNext(e)):"undefined"==typeof e?alert("未定义"):CSDWPOLO.changeStatsOnStepsPanelNext(e)}),setTimeout(function(){CSDWPOLO.init3DView()},400)},CSDWPOLO.changeStatsOnStepsPanelPre=function(e){$(".panel-content > div").eq(e-1).css({display:"block"}),$(".steps div").eq(e).css({borderRight:"1px solid rgb(215, 215, 215)",borderTop:"1px solid rgb(215, 215, 215)",borderLeft:"1px solid rgb(215, 215, 215)",borderBottom:"1px solid rgb(215, 215, 215)"}),$(".steps div").eq(e-1).css({borderRight:"1px solid rgb(255, 255, 255)",borderTop:"2px solid rgb(6, 243, 13)",borderLeft:"2px solid rgb(6, 243, 13)",borderBottom:"2px solid rgb(6, 243, 13)"})},CSDWPOLO.changeStatsOnStepsPanelNext=function(e){$(".panel-content > div").eq(e+1).css({display:"block"}),$(".steps div").eq(e).css({borderRight:"2px solid rgb(6, 243, 13)",borderTop:"1px solid rgb(6, 243, 13)",borderLeft:"2px solid rgb(6, 243, 13)",borderBottom:"1px solid rgb(6, 243, 13)"}),$(".steps div").eq(e+1).css({borderRight:"1px solid rgb(255, 255, 255)",borderTop:"2px solid rgb(6, 243, 13)",borderLeft:"2px solid rgb(6, 243, 13)",borderBottom:"2px solid rgb(6, 243, 13)"})},CSDWPOLO.getAllCustomInfo=function(){var e={},t=document.getElementsByClassName("polo-real")[0],i=t.getAttribute("styleType");if(e.styleType=i,$(".fabric-type > div").each(function(){if(this.querySelector("div img"))return e.fabricType=[this.getAttribute("fabricType"),this.getAttribute("tipName")],!1}),$(".fabric-color div").each(function(){if(this.querySelector("div img"))return e.fabricCollor=[this.getAttribute("fabricCollorName"),this.getAttribute("tipName")],!1}),$(".collar-type > div").each(function(){if(this.querySelector("div img"))return e.collarType=[this.getAttribute("collarType"),this.getAttribute("tipName")],!1}),$(".stripe-type > div").each(function(){if(this.querySelector("div img"))return e.stripeShape=[this.getAttribute("stripeType"),this.getAttribute("tipName")],!1}),$(".topfly-type > div").each(function(){if(this.querySelector("div img"))return e.topflyType=[this.getAttribute("topflyType"),this.getAttribute("tipName")],!1}),$(".cuff-type > div").each(function(){if(this.querySelector("div img"))return e.cuffType=[this.getAttribute("cuffType"),this.getAttribute("tipName")],!1}),$(".lowerhem-type > div").each(function(){if(this.querySelector("div img"))return e.lowerhemType=[this.getAttribute("lowerhemType"),this.getAttribute("tipName")],!1}),$(".fork-type > div").each(function(){if(this.querySelector("div img"))return e.forkType=[this.getAttribute("forkType"),this.getAttribute("tipName")],!1}),$(".braid-type > div").each(function(){if(this.querySelector("div img"))return e.braidType=[this.getAttribute("braidType"),this.getAttribute("tipName")],!1}),$(".pocket-type > div").each(function(){if(this.querySelector("div img"))return e.pocketType=[this.getAttribute("pocketType"),this.getAttribute("tipName")],!1}),$(".penBag-type > div").each(function(){if(this.querySelector("div img"))return e.penBagType=[this.getAttribute("penBagType"),this.getAttribute("tipName")],!1}),$(".turtle-type > div").each(function(){if(this.querySelector("div img"))return e.turtleType=[this.getAttribute("turtleType"),this.getAttribute("tipName")],!1}),"blue"==e.fabricCollor[0]){var o=THREE.ImageUtils.loadTexture("./js/changeLogo/model/lingkou1.jpg");CSDWPOLO.app.lingkouMesh.material.map=o}else if("purple"==e.fabricCollor[0]){var a=THREE.ImageUtils.loadTexture("./js/changeLogo/model/lingkou2.jpg");CSDWPOLO.app.lingkouMesh.material.map=a}else{var n=THREE.ImageUtils.loadTexture("./js/changeLogo/model/maps/T1_map_color.jpg");CSDWPOLO.app.lingkouMesh.material.map=n;var l=THREE.ImageUtils.loadTexture("./js/changeLogo/model/new/newxiukou/baise.jpg");CSDWPOLO.app.xiukouMesh.material.map=l}alert("Well Done！您定制的信息：\n衣服款式："+e.styleType+"\n面料类型："+e.fabricType[0]+" "+e.fabricType[1]+"\n面料颜色："+e.fabricCollor[0]+" "+e.fabricCollor[1]+"\n领型："+e.collarType[0]+" "+e.collarType[1]+"\n条纹："+e.stripeShape[0]+" "+e.stripeShape[1]+"\n门襟："+e.topflyType[0]+" "+e.topflyType[1]+"\n袖口："+e.cuffType[0]+" "+e.cuffType[1]+"\n下摆："+e.lowerhemType[0]+" "+e.lowerhemType[1]+"\n脚衩："+e.forkType[0]+" "+e.forkType[1]+"\n织带："+e.braidType[0]+" "+e.braidType[1]+"\n口袋："+e.pocketType[0]+" "+e.pocketType[1]+"\n笔袋："+e.penBagType[0]+" "+e.penBagType[1]+"\n龟背："+e.turtleType[0]+" "+e.turtleType[1]+"\n下一步您可以自定义logo了！\n")},CSDWPOLO.init3DView=function(){function e(){m.update();var t=h.getDelta();g.update(t),y.position.set(u.position.x+20,u.position.y+10,u.position.z),requestAnimationFrame(e),c.render(d,u)}var t,i,o,a=THREE.ImageUtils.loadTexture("./js/changeLogo/laozi1.jpg"),n=THREE.ImageUtils.loadTexture("./js/changeLogo/model/logo1.png"),l=THREE.ImageUtils.loadTexture("./js/changeLogo/model/logo2.png"),r=THREE.ImageUtils.loadTexture("./js/changeLogo/model/lingkou1.jpg"),s=THREE.ImageUtils.loadTexture("./js/changeLogo/model/lingkou_new.jpg"),p=function(e){e.traverse(function(e){e instanceof THREE.Mesh&&e.material.color.setHex(8947848)})},c=new THREE.WebGLRenderer;c.setSize(750,670),c.setClearColor(8947848),c.shadowMapEnabled=!0,CSDWPOLO.app.webglRender=c,document.getElementById("modelContainer").appendChild(c.domElement),c.shadowMapEnabled=!0;var d=new THREE.Scene,u=new THREE.PerspectiveCamera(45,1,.1,1e3);u.position.set(0,10,40),u.lookAt(new THREE.Vector3(0,0,0));var g=new THREE.OrbitControls(u,c.domElement),h=new THREE.Clock,m=new Stats;m.setMode(0),m.domElement.style.position="absolute",m.domElement.style.top=m.domElement.style.right="0px",m.domElement.style.display="none",d.add(new THREE.AmbientLight(16777215));var y=new THREE.DirectionalLight(16777215,1);y.position.set(100,100,100),y.castShadow=!0,y.shadowMapWidth=y.shadowMapHeight=4096,y.shadowCameraFar=500,y.shadowCameraNear=10,y.shadowDarkness=.35,d.add(y);var f=new THREE.Group;d.add(f);var b=new THREE.OBJMTLLoader;b.load("./js/changeLogo/model/new/yishen/yishen.obj","./js/changeLogo/model/new/yishen/yishen.mtl",function(e){p(e),e.traverse(function(e){e instanceof THREE.Mesh&&(e.material.side=THREE.DoubleSide)}),f.add(e)}),b.load("./js/changeLogo/model/new/lingzi/lingzi.obj","./js/changeLogo/model/new/lingzi/lingzi.mtl",function(e){p(e),e.traverse(function(e){e instanceof THREE.Mesh&&(e.material.side=THREE.DoubleSide,CSDWPOLO.app.lingkouMesh=e,t=e.material.map)}),f.add(e)}),b.load("./js/changeLogo/model/logo.obj","./js/changeLogo/model/logo.mtl",function(e){p(e),e.traverse(function(e){e instanceof THREE.Mesh&&(e.material=new THREE.MeshLambertMaterial({transparent:!0,map:a}),CSDWPOLO.app.logoMesh=e,i=CSDWPOLO.app.logoMesh.geometry,o=i.faceVertexUvs[0],CSDWPOLO.app.logoMap=e.material.map)}),CSDWPOLO.app.logoMesh.visible=!1,e.position.set(0,15,.8),f.add(e)}),b.load("./js/changeLogo/model/new/xiukou/xiukou.obj","./js/changeLogo/model/new/xiukou/xiukou.mtl",function(e){p(e),e.traverse(function(e){e instanceof THREE.Mesh&&(e.material.side=THREE.DoubleSide,CSDWPOLO.app.xiukouMesh=e)}),f.add(e)}),f.position.set(0,-20,0),f.scale.x=1,f.scale.y=1.2,f.scale.z=1,e(),CSDWPOLO.app.smallerLogo=function(){if(void 0!=CSDWPOLO.app.logoMesh){for(var e=0;e!=o.length;++e)for(var t=o[e],a=0;a!=t.length;++a){var n=t[a];n.x=2*n.x-.5,n.y=2*n.y-.5}i.uvsNeedUpdate=!0}},CSDWPOLO.app.biggerLogo=function(){if(void 0!=CSDWPOLO.app.logoMesh){for(var e=0;e!=o.length;++e)for(var t=o[e],a=0;a!=t.length;++a){var n=t[a];n.x=(n.x+.5)/2,n.y=(n.y+.5)/2}i.uvsNeedUpdate=!0}};var v=1;CSDWPOLO.app.smallerModel=function(){v-=.1,.7>v&&(v=.7),f.scale.set(v,v,v)},CSDWPOLO.app.biggerModel=function(){v+=.1,1.2<v&&(v=1.2),f.scale.set(v,v,v)},CSDWPOLO.app.moveLeft=function(){if(void 0!=CSDWPOLO.app.logoMesh){for(var e=0;e!=o.length;++e)for(var t=o[e],a=0;a!=t.length;++a)t[a].x+=.1;i.uvsNeedUpdate=!0}},CSDWPOLO.app.moveRight=function(){if(void 0!=CSDWPOLO.app.logoMesh){for(var e=0;e!=o.length;++e)for(var t=o[e],a=0;a!=t.length;++a)t[a].x-=.1;i.uvsNeedUpdate=!0}},CSDWPOLO.app.moveTop=function(){if(void 0!=app.logoMesh){for(var e=0;e!=o.length;++e)for(var t=o[e],a=0;a!=t.length;++a)t[a].y-=.1;i.uvsNeedUpdate=!0}},CSDWPOLO.app.moveBottom=function(){if(void 0!=CSDWPOLO.app.logoMesh){for(var e=0;e!=o.length;++e)for(var t=o[e],a=0;a!=t.length;++a)t[a].y+=.1;i.uvsNeedUpdate=!0}},CSDWPOLO.app.changeLogo=function(){CSDWPOLO.app.logoMesh.material.map=a},CSDWPOLO.app.changeLogo1=function(){CSDWPOLO.app.logoMesh.material.map=n},CSDWPOLO.app.changeLogo2=function(){CSDWPOLO.app.logoMesh.material.map=l},CSDWPOLO.app.changeLingkou=function(){CSDWPOLO.app.lingkouMesh.material.map=t},CSDWPOLO.app.changeLingkou1=function(){CSDWPOLO.app.lingkouMesh.material.map=r},CSDWPOLO.app.changeLingkou2=function(){CSDWPOLO.app.lingkouMesh.material.map=s},CSDWPOLO.initDIY()},CSDWPOLO.initDIY=function(){function e(){var e=hbdiy.download();hbdiy.unlock(),CSDWPOLO.app.logoMap=THREE.ImageUtils.loadTexture(e),CSDWPOLO.app.logoMesh.material.map=CSDWPOLO.app.logoMap,setTimeout(function(){hbdiy.unlock()},100)}var t=document.getElementById("logoCanvas");t.width=320,t.height=300;var i={x:65,y:30,w:186,h:249},o=i,a={maxSize_image:5,scaleScope_max:2,scaleScope_min:.1,lineWidth:1,strokeStyle:"#000000",fillStyle:"#000000",nodeStyle:0,scaleAreaSize:4};hbdiy.init({diyid:"logoCanvas",scope_x:o.x,scope_y:o.y,scope_width:o.w,scope_height:o.h,maxSize_image:a.maxSize_image,maxSize_text:5,scaleScope_max:a.scaleScope_max,scaleScope_min:a.scaleScope_min,resizeType:1,lineWidth:a.lineWidth,strokeStyle:a.strokeStyle,fillStyle:a.fillStyle,nodeStyle:a.nodeStyle,scaleAreaSize:a.scaleAreaSize,debug:a.debug,tools:"./js/changeLogo/test/images/tools.png"}),hbdiy.unlock();var n=document.getElementById("uploadedFile");n.onchange=function(){if(0!==n.files.length){var e=n.files[0];if(!/image\/\w+/.test(e.type))return alert("看清楚，这个需要图片！"),!1;var t=new FileReader;t.readAsDataURL(n.files[0]),t.onload=function(e){hbdiy.addImage(e.target.result,e.target.result,1)}}},$("#uploadImg").bind("click",function(){n.click()}),document.getElementById("applyToModel").onclick=e},CSDWPOLO.preview=function(){$.fancybox($("#step3").html(),{autoDimensions:!1,autoScale:!1,scrolling:"no",width:1080,height:700,speedIn:600,speedOut:200,overflow:"hidden",overlayShow:!0,hideOnOverlayClick:!0,beforeShow:function(){document.getElementById("cover").style.display="block",$(".panel-content > div").each(function(e){if("block"==this.style.display&&e!==$(".panel-content > div").length-1)return CSDWPOLO.app.logoMesh.visible=!1,!1}),CSDWPOLO.getAllCustomInfo_sec(),document.getElementById("f5list").appendChild(CSDWPOLO.app.webglRender.domElement)},afterShow:function(){document.getElementById("cover").style.display="none"},beforeClose:function(){document.getElementById("modelContainer").appendChild(CSDWPOLO.app.webglRender.domElement)}})},CSDWPOLO.saveCustomInfo=function(){alert("将用户的定制信息提交到当前用户的账户中!")},CSDWPOLO.getAllCustomInfo_sec=function(){var e={},t=document.getElementsByClassName("polo-real")[0],i=t.getAttribute("styleType");if(e.styleType=i,$(".fabric-type > div").each(function(){if(this.querySelector("div img"))return e.fabricType=[this.getAttribute("fabricType"),this.getAttribute("tipName")],!1}),$(".fabric-color div").each(function(){if(this.querySelector("div img"))return e.fabricCollor=[this.getAttribute("fabricCollorName"),this.getAttribute("tipName")],!1}),$(".collar-type > div").each(function(){if(this.querySelector("div img"))return e.collarType=[this.getAttribute("collarType"),this.getAttribute("tipName")],!1}),$(".stripe-type > div").each(function(){if(this.querySelector("div img"))return e.stripeShape=[this.getAttribute("stripeType"),this.getAttribute("tipName")],!1}),$(".topfly-type > div").each(function(){if(this.querySelector("div img"))return e.topflyType=[this.getAttribute("topflyType"),this.getAttribute("tipName")],!1}),$(".cuff-type > div").each(function(){if(this.querySelector("div img"))return e.cuffType=[this.getAttribute("cuffType"),this.getAttribute("tipName")],!1}),$(".lowerhem-type > div").each(function(){if(this.querySelector("div img"))return e.lowerhemType=[this.getAttribute("lowerhemType"),this.getAttribute("tipName")],!1}),$(".fork-type > div").each(function(){if(this.querySelector("div img"))return e.forkType=[this.getAttribute("forkType"),this.getAttribute("tipName")],!1}),$(".braid-type > div").each(function(){if(this.querySelector("div img"))return e.braidType=[this.getAttribute("braidType"),this.getAttribute("tipName")],!1}),$(".pocket-type > div").each(function(){if(this.querySelector("div img"))return e.pocketType=[this.getAttribute("pocketType"),this.getAttribute("tipName")],!1}),$(".penBag-type > div").each(function(){if(this.querySelector("div img"))return e.penBagType=[this.getAttribute("penBagType"),this.getAttribute("tipName")],!1}),$(".turtle-type > div").each(function(){if(this.querySelector("div img"))return e.turtleType=[this.getAttribute("turtleType"),this.getAttribute("tipName")],!1}),"blue"==e.fabricCollor[0]){var o=THREE.ImageUtils.loadTexture("./js/changeLogo/model/lingkou1.jpg");CSDWPOLO.app.lingkouMesh.material.map=o}else if("purple"==e.fabricCollor[0]){var a=THREE.ImageUtils.loadTexture("./js/changeLogo/model/lingkou2.jpg");CSDWPOLO.app.lingkouMesh.material.map=a}else{var n=THREE.ImageUtils.loadTexture("./js/changeLogo/model/maps/T1_map_color.jpg");CSDWPOLO.app.lingkouMesh.material.map=n;var l=THREE.ImageUtils.loadTexture("./js/changeLogo/model/new/newxiukou/baise.jpg");CSDWPOLO.app.xiukouMesh.material.map=l}},CSDWPOLO.showShirtInApp=function(e){function t(e){var t=[],i=document.createElement("div");i.style.backgroundImage="url(./images/wholePolo/"+e+"1.jpg)",i.style.backgroundSize="cover",i.style.display="block",i.className="piece",t.push(i);var o=document.createElement("div");o.style.backgroundImage="url(./images/wholePolo/"+e+"2.jpg)",o.style.backgroundSize="cover",o.style.display="none",o.className="piece",t.push(o);var a=document.createElement("div");a.style.backgroundImage="url(./images/wholePolo/"+e+"3.jpg)",a.style.backgroundSize="cover",a.style.display="none",a.className="piece",t.push(a);var n=document.createElement("div");return n.style.backgroundImage="url(./images/wholePolo/"+e+"4.jpg)",n.style.backgroundSize="cover",n.style.display="none",n.className="piece",t.push(n),t}$(".polo-real").html("");var i=document.getElementsByClassName("polo-real")[0];switch(e){case"huanghei":var o=t("huanghei/huanghei");$.each(o,function(e,t){i.appendChild(t)}),i.setAttribute("styleType","huanghei");break;case"huanglan":var o=t("huanglan/hl");$.each(o,function(e,t){i.appendChild(t)}),i.setAttribute("styleType","huanglan");break;case"huise":var o=t("huise/hs");$.each(o,function(e,t){i.appendChild(t)}),i.setAttribute("styleType","huise");break;case"lanhei":var o=t("lanhei/lanhei");$.each(o,function(e,t){i.appendChild(t)}),i.setAttribute("styleType","lanhei")}};